{% comment %}
  Typography Presets for Enterprise-Level Customization
  
  This snippet provides JavaScript functionality to apply typography presets
  when a preset is selected in the theme settings. It overrides individual
  settings with predefined values for different brand aesthetics.
{% endcomment %}

<script>
  // Typography presets configuration
  const TYPOGRAPHY_PRESETS = {
    modern_minimal: {
      main_heading_font_size: 36,
      main_heading_font_weight: '300',
      main_heading_line_height: 1.1,
      main_heading_letter_spacing: -0.5,
      main_heading_text_transform: 'lowercase',
      main_heading_text_decoration: 'none',
      main_heading_text_shadow: 'none',
      sub_heading_font_size: 20,
      sub_heading_font_weight: '400',
      sub_heading_line_height: 1.3,
      sub_heading_letter_spacing: 0,
      sub_heading_text_transform: 'none',
      sub_heading_text_decoration: 'none',
      sub_heading_text_shadow: 'none',
      body_text_font_size: 16,
      body_text_font_weight: '400',
      body_text_line_height: 1.6,
      body_text_letter_spacing: 0,
      body_text_text_transform: 'none'
    },
    elegant_serif: {
      main_heading_font_size: 48,
      main_heading_font_weight: '400',
      main_heading_line_height: 1.2,
      main_heading_letter_spacing: -0.3,
      main_heading_text_transform: 'none',
      main_heading_text_decoration: 'none',
      main_heading_text_shadow: 'none',
      sub_heading_font_size: 28,
      sub_heading_font_weight: '500',
      sub_heading_line_height: 1.4,
      sub_heading_letter_spacing: 0,
      sub_heading_text_transform: 'none',
      sub_heading_text_decoration: 'none',
      sub_heading_text_shadow: 'none',
      body_text_font_size: 18,
      body_text_font_weight: '400',
      body_text_line_height: 1.7,
      body_text_letter_spacing: 0.2,
      body_text_text_transform: 'none'
    },
    bold_impact: {
      main_heading_font_size: 56,
      main_heading_font_weight: '800',
      main_heading_line_height: 1.0,
      main_heading_letter_spacing: -1,
      main_heading_text_transform: 'uppercase',
      main_heading_text_decoration: 'none',
      main_heading_text_shadow: '2px 2px 4px rgba(0,0,0,0.3)',
      sub_heading_font_size: 32,
      sub_heading_font_weight: '700',
      sub_heading_line_height: 1.2,
      sub_heading_letter_spacing: 0.5,
      sub_heading_text_transform: 'uppercase',
      sub_heading_text_decoration: 'none',
      sub_heading_text_shadow: '1px 1px 2px rgba(0,0,0,0.2)',
      body_text_font_size: 16,
      body_text_font_weight: '500',
      body_text_line_height: 1.5,
      body_text_letter_spacing: 0.3,
      body_text_text_transform: 'none'
    },
    clean_corporate: {
      main_heading_font_size: 40,
      main_heading_font_weight: '600',
      main_heading_line_height: 1.2,
      main_heading_letter_spacing: -0.2,
      main_heading_text_transform: 'none',
      main_heading_text_decoration: 'none',
      main_heading_text_shadow: 'none',
      sub_heading_font_size: 22,
      sub_heading_font_weight: '600',
      sub_heading_line_height: 1.3,
      sub_heading_letter_spacing: 0,
      sub_heading_text_transform: 'none',
      sub_heading_text_decoration: 'none',
      sub_heading_text_shadow: 'none',
      body_text_font_size: 15,
      body_text_font_weight: '400',
      body_text_line_height: 1.6,
      body_text_letter_spacing: 0,
      body_text_text_transform: 'none'
    },
    creative_artistic: {
      main_heading_font_size: 44,
      main_heading_font_weight: '700',
      main_heading_line_height: 1.1,
      main_heading_letter_spacing: 1,
      main_heading_text_transform: 'capitalize',
      main_heading_text_decoration: 'none',
      main_heading_text_shadow: '3px 3px 6px rgba(0,0,0,0.4)',
      sub_heading_font_size: 26,
      sub_heading_font_weight: '600',
      sub_heading_line_height: 1.3,
      sub_heading_letter_spacing: 0.3,
      sub_heading_text_transform: 'none',
      sub_heading_text_decoration: 'underline',
      sub_heading_text_shadow: '1px 1px 3px rgba(0,0,0,0.3)',
      body_text_font_size: 17,
      body_text_font_weight: '400',
      body_text_line_height: 1.6,
      body_text_letter_spacing: 0.1,
      body_text_text_transform: 'none'
    }
  };

  // Function to apply typography preset
  function applyTypographyPreset(presetName) {
    if (presetName === 'custom' || !TYPOGRAPHY_PRESETS[presetName]) {
      return;
    }

    const preset = TYPOGRAPHY_PRESETS[presetName];
    
    // Apply preset values to CSS custom properties
    const root = document.documentElement;
    
    // Main heading properties
    root.style.setProperty('--font-main-heading-desktop', preset.main_heading_font_size + 'px');
    root.style.setProperty('--font-main-heading-tablet', Math.floor(preset.main_heading_font_size * 0.9) + 'px');
    root.style.setProperty('--font-main-heading-mobile', Math.floor(preset.main_heading_font_size * 0.8) + 'px');
    root.style.setProperty('--font-weight-main-heading', preset.main_heading_font_weight);
    root.style.setProperty('--line-height-main-heading-ratio', preset.main_heading_line_height);
    root.style.setProperty('--letter-spacing-main-heading', preset.main_heading_letter_spacing + 'px');
    root.style.setProperty('--text-transform-main-heading', preset.main_heading_text_transform);
    root.style.setProperty('--text-decoration-main-heading', preset.main_heading_text_decoration);
    root.style.setProperty('--text-shadow-main-heading', preset.main_heading_text_shadow);
    
    // Sub heading properties
    root.style.setProperty('--font-sub-heading-desktop', preset.sub_heading_font_size + 'px');
    root.style.setProperty('--font-sub-heading-tablet', Math.floor(preset.sub_heading_font_size * 0.9) + 'px');
    root.style.setProperty('--font-sub-heading-mobile', Math.floor(preset.sub_heading_font_size * 0.8) + 'px');
    root.style.setProperty('--font-weight-sub-heading', preset.sub_heading_font_weight);
    root.style.setProperty('--line-height-sub-heading-ratio', preset.sub_heading_line_height);
    root.style.setProperty('--letter-spacing-sub-heading', preset.sub_heading_letter_spacing + 'px');
    root.style.setProperty('--text-transform-sub-heading', preset.sub_heading_text_transform);
    root.style.setProperty('--text-decoration-sub-heading', preset.sub_heading_text_decoration);
    root.style.setProperty('--text-shadow-sub-heading', preset.sub_heading_text_shadow);
    
    // Body text properties
    root.style.setProperty('--font-body-text-desktop', preset.body_text_font_size + 'px');
    root.style.setProperty('--font-body-text-tablet', preset.body_text_font_size + 'px');
    root.style.setProperty('--font-body-text-mobile', preset.body_text_font_size + 'px');
    root.style.setProperty('--font-weight-body-text', preset.body_text_font_weight);
    root.style.setProperty('--line-height-body-text-ratio', preset.body_text_line_height);
    root.style.setProperty('--letter-spacing-body-text', preset.body_text_letter_spacing + 'px');
    root.style.setProperty('--text-transform-body-text', preset.body_text_text_transform);
    
    // Dispatch event to notify other components
    document.dispatchEvent(new CustomEvent('typography-preset-applied', {
      detail: { preset: presetName, values: preset }
    }));
  }

  // Initialize preset on page load
  document.addEventListener('DOMContentLoaded', function() {
    const currentPreset = '{{ settings.typography_preset | default: "custom" }}';
    if (currentPreset !== 'custom') {
      applyTypographyPreset(currentPreset);
    }
  });

  // Accessibility enhancements
  function applyAccessibilityFeatures() {
    if ({{ settings.enable_accessibility_features | default: true }}) {
      const root = document.documentElement;
      
      // Respect user's reduced motion preference
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        root.style.setProperty('--m-animation-duration', '0.01ms');
        root.style.setProperty('--m-duration-default', '0.01ms');
      }
      
      // Respect user's contrast preference
      if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
        root.style.setProperty('--font-weight-main-heading', '700');
        root.style.setProperty('--font-weight-sub-heading', '600');
        root.style.setProperty('--font-weight-body-text', '500');
      }
      
      // Monitor for changes in user preferences
      window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', function(e) {
        if (e.matches) {
          root.style.setProperty('--m-animation-duration', '0.01ms');
          root.style.setProperty('--m-duration-default', '0.01ms');
        } else {
          root.style.removeProperty('--m-animation-duration');
          root.style.removeProperty('--m-duration-default');
        }
      });
      
      window.matchMedia('(prefers-contrast: high)').addEventListener('change', function(e) {
        if (e.matches) {
          root.style.setProperty('--font-weight-main-heading', '700');
          root.style.setProperty('--font-weight-sub-heading', '600');
          root.style.setProperty('--font-weight-body-text', '500');
        } else {
          root.style.removeProperty('--font-weight-main-heading');
          root.style.removeProperty('--font-weight-sub-heading');
          root.style.removeProperty('--font-weight-body-text');
        }
      });
    }
  }

  // Initialize accessibility features
  document.addEventListener('DOMContentLoaded', applyAccessibilityFeatures);
  
  // Performance optimization for font loading
  function optimizeTypographyPerformance() {
    if ({{ settings.enable_typography_optimization | default: true }}) {
      // Add font-display CSS to improve loading performance
      const style = document.createElement('style');
      style.textContent = `
        @font-face {
          font-display: {{ settings.font_display_strategy | default: 'swap' }};
        }
      `;
      document.head.appendChild(style);
    }
  }

  // Initialize performance optimizations
  document.addEventListener('DOMContentLoaded', optimizeTypographyPerformance);
  
  // Expose functions for theme customizer
  window.MinimogTypography = {
    applyPreset: applyTypographyPreset,
    presets: TYPOGRAPHY_PRESETS
  };
</script>

<style>
  /* CSS for conditional fluid typography */
  {% if settings.enable_fluid_typography %}
    @media (min-width: {{ settings.fluid_typography_min_width | default: 320 }}px) and (max-width: {{ settings.fluid_typography_max_width | default: 1200 }}px) {
      .main-heading {
        font-size: clamp(
          calc(((var(--font-main-heading-mobile)) / (var(--font-base-size))) * 1rem),
          calc(((var(--font-main-heading-mobile)) / (var(--font-base-size))) * 1rem) + 2vw,
          calc(((var(--font-main-heading-desktop)) / (var(--font-base-size))) * 1rem)
        );
      }
      
      .sub-heading {
        font-size: clamp(
          calc(((var(--font-sub-heading-mobile)) / (var(--font-base-size))) * 1rem),
          calc(((var(--font-sub-heading-mobile)) / (var(--font-base-size))) * 1rem) + 1vw,
          calc(((var(--font-sub-heading-desktop)) / (var(--font-base-size))) * 1rem)
        );
      }
      
      .body-text {
        font-size: clamp(
          calc(((var(--font-body-text-mobile)) / (var(--font-base-size))) * 1rem),
          calc(((var(--font-body-text-mobile)) / (var(--font-base-size))) * 1rem) + 0.5vw,
          calc(((var(--font-body-text-desktop)) / (var(--font-base-size))) * 1rem)
        );
      }
    }
  {% endif %}
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .main-heading, .sub-heading, .body-text {
      font-weight: 600;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>