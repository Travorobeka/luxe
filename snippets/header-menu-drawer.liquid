{% liquid
  assign main_menu = section.settings.main_menu
  assign mobile_menu = section.settings.mobile_menu

  if mobile_menu == blank
    assign menu = main_menu
  else
    assign menu = mobile_menu
  endif
%}
<div id="m-menu-drawer" class="m-menu-drawer">
  <div class="m-menu-drawer__bg" style="
    position: absolute; inset: 0; z-index: 0;
    background-color: #fff;
  "></div>
  <div class="m-menu-drawer__backdrop"></div>
  <div class="m-menu-drawer__wrapper">
    <!-- Custom close button removed: all close icon customizations will be applied to the hamburger/close icon in the header -->
    <div class="m-menu-drawer__content" style="
      padding-left: {{ section.settings.mb_drawer_padding_x | default: 24 }}px;
      padding-right: {{ section.settings.mb_drawer_padding_x | default: 24 }}px;
      padding-top: {{ section.settings.mb_drawer_padding_y | default: 24 }}px;
      padding-bottom: {{ section.settings.mb_drawer_padding_y | default: 24 }}px;
      position: relative;
      z-index: 1;
    ">
      {%- if section.settings.mb_drawer_product_images_enable -%}
        {%- assign layout = section.settings.mb_drawer_product_images_layout | default: 'row' -%}
        {%- assign alignment = section.settings.mb_drawer_product_images_alignment | default: 'center' -%}
        {%- assign product_count = section.settings.mb_drawer_product_images_count | default: 1 -%}
        {%- assign padding_top = section.settings.mb_drawer_product_images_padding_top | default: 0 -%}
        {%- assign padding_bottom = section.settings.mb_drawer_product_images_padding_bottom | default: 24 -%}
        <div class="m-menu-drawer__product-images m-drawer-product-images-custom
          {% if layout == 'row' %}
            m:flex m:gap-4 m:mb-6
            {% if alignment == 'center' %} m:justify-center
            {% elsif alignment == 'right' %} m:justify-end
            {% else %} m:justify-start
            {% endif %}
          {% elsif layout == 'grid' %}
            m:grid m:gap-4 m:mb-6 m:grid-cols-2
            {% if alignment == 'center' %} m:justify-items-center
            {% elsif alignment == 'right' %} m:justify-items-end
            {% else %} m:justify-items-start
            {% endif %}
          {% endif %}"
          style="padding-top: {{ padding_top }}px; padding-bottom: {{ padding_bottom }}px;">
          {%- assign aspect_ratio = section.settings.mb_drawer_product_images_aspect_ratio | default: '1/1' -%}
          {%- assign border_radius = section.settings.mb_drawer_product_images_radius | default: 8 -%}
          {%- for i in (1..product_count) -%}
            {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_source' -%}
            {%- assign source = section.settings[key] | default: 'upload' -%}
            <div class="m-menu-drawer__product-image-item m:flex m:flex-col m:items-center" style="width: 80px;">
              {%- assign aspect_ratio = section.settings.mb_drawer_product_images_aspect_ratio | default: '1/1' -%}
              {%- assign aspect_w = aspect_ratio | split: '/' | first | default: 1 -%}
              {%- assign aspect_h = aspect_ratio | split: '/' | last | default: 1 -%}
              {%- assign aspect_percent = 100 | times: aspect_h | divided_by: aspect_w -%}
              <div class="m-menu-drawer__product-image-wrapper"
                   style="overflow: hidden; border-radius: {{ border_radius }}px; width: 100%; background: #f5f5f5; position: relative; padding-bottom: {{ aspect_percent }}%;">
                {%- case source -%}
                  {%- when 'upload' -%}
                    {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_upload' -%}
                    {%- assign img = section.settings[key] -%}
                    {%- if img != blank -%}
                      <img src="{{ img | image_url: width: 160 }}" alt="Drawer product image {{ i }}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;" loading="lazy" />
                    {%- else -%}
                      <div style="width:100%;height:100%;background:#eee;position:absolute;top:0;left:0;"></div>
                    {%- endif -%}
                  {%- when 'product' -%}
                    {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_product' -%}
                    {%- assign product = section.settings[key] -%}
                    {%- if product != blank and all_products[product] and all_products[product].featured_image != blank -%}
                      <img src="{{ all_products[product].featured_image | image_url: width: 160 }}" alt="{{ all_products[product].title | escape }}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;" loading="lazy" />
                    {%- else -%}
                      <div style="width:100%;height:100%;background:#eee;position:absolute;top:0;left:0;"></div>
                    {%- endif -%}
                  {%- when 'collection' -%}
                    {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_collection' -%}
                    {%- assign collection = section.settings[key] -%}
                    {%- if collection != blank and collections[collection] and collections[collection].products.size > 0 and collections[collection].products.first.featured_image != blank -%}
                      <img src="{{ collections[collection].products.first.featured_image | image_url: width: 160 }}" alt="{{ collections[collection].products.first.title | escape }}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;" loading="lazy" />
                    {%- else -%}
                      <div style="width:100%;height:100%;background:#eee;position:absolute;top:0;left:0;"></div>
                    {%- endif -%}
                  {%- else -%}
                    <div style="width:100%;height:100%;background:#eee;position:absolute;top:0;left:0;"></div>
                {%- endcase -%}
              </div>
              {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_label' -%}
              {%- assign label = section.settings[key] -%}
              {%- if label != blank -%}
                {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_label_size' -%}
                {%- assign label_size = section.settings[key] | default: 16 -%}
                {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_label_weight' -%}
                {%- assign label_weight = section.settings[key] | default: 500 -%}
                {%- assign key = 'mb_drawer_product_image_' | append: i | append: '_label_color' -%}
                {%- assign label_color = section.settings[key] | default: '#222' -%}
                <span class="m-menu-drawer__product-image-label" style="font-size: {{ label_size }}px; font-weight: {{ label_weight }}; color: {{ label_color }}; margin-top: 6px; text-align: center; display: block;">
                  {{ label }}
                </span>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}
      <ul class="m-menu-drawer__navigation m-menu-mobile m-footer--accordion">
        {% for link in linklists[menu].links %}
          <li class="m-accordion--item" style="margin-bottom: {{ section.settings.mb_menu_btn_spacing | default: 12 }}px;">
            <div class="m-accordion--item-button m-menu-mobile__link"
              style="
                background: {{ section.settings.mb_menu_btn_bg | default: '#fff' }};
                border: {{ section.settings.mb_menu_btn_border_width | default: 1 }}px solid {{ section.settings.mb_menu_btn_border_color | default: '#e5e5e5' }};
                border-radius: {{ section.settings.mb_menu_btn_radius | default: 8 }}px;
                font-family: {{ section.settings.mb_menu_btn_font_family | default: 'roboto_n4' }};
                font-size: {{ section.settings.mb_menu_btn_font_size | default: 16 }}px;
                font-weight: {{ section.settings.mb_menu_btn_font_weight | default: 500 }};
                font-style: {{ section.settings.mb_menu_btn_font_style | default: 'normal' }};
                letter-spacing: {{ section.settings.mb_menu_btn_letter_spacing | default: 0.2 }}px;
                text-transform: {{ section.settings.mb_menu_btn_text_transform | default: 'none' }};
                padding: {{ section.settings.mb_menu_btn_padding_v | default: 12 }}px {{ section.settings.mb_menu_btn_padding_h | default: 16 }}px;
                display: flex; align-items: center; justify-content: space-between;
                transition: background 0.2s;
              "
              onmouseover="this.style.background='{{ section.settings.mb_menu_btn_bg_hover | default: '#f5f5f5' }}'"
              onmouseout="this.style.background='{{ section.settings.mb_menu_btn_bg | default: '#fff' }}'"
            >
              <span>{{ link.title }}</span>
              <span class="m-accordion--item-icon" style="color: {{ section.settings.mb_menu_sub_toggle_icon_color | default: '#222' }};">
                {% case section.settings.mb_menu_sub_toggle_icon %}
                  {% when 'caret' %}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  {% when 'arrow' %}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  {% when 'plus' %}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 4V12M4 8H12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  {% else %}
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                {% endcase %}
              </span>
            </div>
            {% if link.links != blank %}
              <div class="m-accordion--item-content" style="
                margin-top: {{ section.settings.mb_menu_sub_top_offset | default: 8 }}px;
                font-size: {{ section.settings.mb_menu_sub_font_size | default: 14 }}px;
                color: {{ section.settings.mb_menu_sub_font_color | default: '#222' }};
                font-weight: {{ section.settings.mb_menu_sub_font_weight | default: 400 }};
              ">
                <ul class="m-link-lists">
                  {% for child in link.links %}
                    <li class="m-link-lists--item" style="padding-left: {{ section.settings.mb_menu_sub_indent | default: 16 }}px;">
                      <a href="{{ child.url }}" class="m-link">{{ child.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
      {% render 'mega-menu-customer', section: section %}
      {%- assign secondary_menu = section.settings.mb_drawer_secondary_menu -%}
      {% if section.settings.mb_drawer_secondary_layout contains 'grid' %}
        {% assign secondary_menu_display = 'grid' %}
      {% else %}
        {% assign secondary_menu_display = 'flex' %}
      {% endif %}
      {% if secondary_menu != blank and linklists[secondary_menu] and linklists[secondary_menu].links.size > 0 %}
        <ul
          class="m-menu-drawer__secondary-menu"
          style="
            margin-top: 24px;
            gap: {{ section.settings.mb_drawer_secondary_gap | default: 12 }}px;
            display: {{ secondary_menu_display }};
            flex-direction: column;
            grid-template-columns: {% if section.settings.mb_drawer_secondary_layout == 'grid-2' %}repeat(2, 1fr){% elsif section.settings.mb_drawer_secondary_layout == 'grid-3' %}repeat(3, 1fr){% else %}none{% endif %};
            background: {{ section.settings.mb_drawer_secondary_bg_color | default: '#FBF7F0' }};
            padding: 0;
          "
        >
          {% for link in linklists[secondary_menu].links %}
            <li>
              <a href="{{ link.url }}" class="m-menu-drawer__secondary-link" style="
                color: {{ section.settings.mb_drawer_secondary_font_color | default: '#222' }};
                font-weight: {{ section.settings.mb_drawer_secondary_font_weight | default: 400 }};
                text-transform: {{ section.settings.mb_drawer_secondary_text_transform | default: 'none' }};
                letter-spacing: {{ section.settings.mb_drawer_secondary_letter_spacing | default: 0.2 }}px;
                font-size: {{ section.settings.mb_drawer_secondary_font_size | default: 16 }}px;
                padding: {{ section.settings.mb_drawer_secondary_padding_v | default: 10 }}px {{ section.settings.mb_drawer_secondary_padding_h | default: 16 }}px;
                display: block;
              ">
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
      <!-- BEGIN: Drawer Bottom Icons & Social Links -->
      <div class="m-menu-drawer__bottom-icons" style="
        display: flex;
        flex-direction: column;
        align-items: {{ section.settings.mb_drawer_bottom_icon_alignment | default: 'center' }};
        margin-top: 32px;
      ">
        <div class="m-menu-drawer__bottom-row" style="
          display: flex;
          gap: {{ section.settings.mb_drawer_bottom_icon_gap | default: 16 }}px;
          justify-content: {{ section.settings.mb_drawer_bottom_icon_alignment | default: 'center' }};
        ">
          {%- if section.settings.mb_drawer_show_account -%}
            <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="m-menu-drawer__icon-link" title="Account">
              {%- if section.settings.mb_drawer_account_icon != blank -%}
                <img src="{{ section.settings.mb_drawer_account_icon | image_url: width: 64 }}" alt="Account" style="width: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; height: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; object-fit: contain;" />
              {%- else -%}
                <svg width="{{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}" height="{{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
              {%- endif -%}
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_language_switcher -%}
            <a href="#language-switcher" class="m-menu-drawer__icon-link" title="Language" style="width: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; height: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; display: flex; align-items: center; justify-content: center;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 0 20M12 2a15.3 15.3 0 0 0 0 20"/></svg>
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_currency_switcher -%}
            <a href="#currency-switcher" class="m-menu-drawer__icon-link" title="Currency" style="width: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; height: {{ section.settings.mb_drawer_bottom_icon_size | default: 24 }}px; display: flex; align-items: center; justify-content: center;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7H14a3.5 3.5 0 0 1 0 7H6"/></svg>
            </a>
          {%- endif -%}
        </div>
        {%- if section.settings.mb_drawer_show_social_icons -%}
        <div class="m-menu-drawer__social-icons" style="
          display: flex;
          gap: {{ section.settings.mb_drawer_social_icon_gap | default: 12 }}px;
          margin-top: 18px;
          justify-content: {{ section.settings.mb_drawer_bottom_icon_alignment | default: 'center' }};
        ">
          {%- if section.settings.mb_drawer_show_instagram and section.settings.mb_drawer_instagram_url != blank -%}
            <a href="{{ section.settings.mb_drawer_instagram_url }}" target="_blank" rel="noopener" class="m-menu-drawer__social-link" title="Instagram" style="color: {{ section.settings.mb_drawer_social_icon_color | default: '#222' }}; width: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px; height: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.5" y2="6.5"/></svg>
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_facebook and section.settings.mb_drawer_facebook_url != blank -%}
            <a href="{{ section.settings.mb_drawer_facebook_url }}" target="_blank" rel="noopener" class="m-menu-drawer__social-link" title="Facebook" style="color: {{ section.settings.mb_drawer_social_icon_color | default: '#222' }}; width: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px; height: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a4 4 0 0 0-4 4v3H7v4h4v8h4v-8h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/></svg>
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_tiktok and section.settings.mb_drawer_tiktok_url != blank -%}
            <a href="{{ section.settings.mb_drawer_tiktok_url }}" target="_blank" rel="noopener" class="m-menu-drawer__social-link" title="TikTok" style="color: {{ section.settings.mb_drawer_social_icon_color | default: '#222' }}; width: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px; height: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 17a5 5 0 1 1 5-5V3h4a5 5 0 0 0 5 5"/></svg>
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_youtube and section.settings.mb_drawer_youtube_url != blank -%}
            <a href="{{ section.settings.mb_drawer_youtube_url }}" target="_blank" rel="noopener" class="m-menu-drawer__social-link" title="YouTube" style="color: {{ section.settings.mb_drawer_social_icon_color | default: '#222' }}; width: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px; height: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="10" rx="2"/><polygon points="10 9 15 12 10 15 10 9"/></svg>
            </a>
          {%- endif -%}
          {%- if section.settings.mb_drawer_show_whatsapp and section.settings.mb_drawer_whatsapp_url != blank -%}
            <a href="{{ section.settings.mb_drawer_whatsapp_url }}" target="_blank" rel="noopener" class="m-menu-drawer__social-link" title="WhatsApp" style="color: {{ section.settings.mb_drawer_social_icon_color | default: '#222' }}; width: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px; height: {{ section.settings.mb_drawer_social_icon_size | default: 20 }}px;">
              <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.05 16.54A9 9 0 1 0 12 21a8.94 8.94 0 0 0 4.84-1.41l3.71 1-1-3.71A8.94 8.94 0 0 0 21.05 16.54z"/><path d="M16.24 7.76a4 4 0 0 1-5.66 5.66"/></svg>
            </a>
          {%- endif -%}
        </div>
        {%- endif -%}
      </div>
      <!-- END: Drawer Bottom Icons & Social Links -->
    </div>
  </div>
</div>
